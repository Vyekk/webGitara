@use 'sass:math';
@use 'variables' as *;

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.3); }
    100% { transform: scale(1); }
}

.fretboard {
    display: flex;
    position: relative;
    flex-direction: column;
    background: #c79d5e;
    width: 100%;
    max-width: 100%;
    height: #{$fretboard-height}px;
    min-height: unset;
    overflow: hidden;
    justify-content: center;
    padding: 0;
}

.string {
    flex: 1 1 auto;
    width: 100%;
    display: flex;
    position: relative;

    @for $i from 1 through length($string-colors) {
        &[data-string="#{$i}"] {
            .noteFret::before { background: nth($string-colors, $i); }
            .noteFret::after { background: nth($string-colors, $i); }
            &::after {
                background: nth($string-colors, $i);
                height: #{nth($strings-height, $i)}px;
                top: calc(50% - #{math.div(nth($strings-height, $i), 2)}px);
            }
            &::before {
                height: #{nth($strings-height, $i)}px;
                top: calc(50% - #{math.div(nth($strings-height, $i), 2)}px);
            }
        }
    }

    &::after { content: ''; width: 100%; z-index: 1; position: absolute; opacity: $note-dot-opacity; }
    &::before { content: ''; width: 100%; background: linear-gradient(#eee, #999); box-shadow: 4.75rem 3px 10px #806233; z-index: 1; position: absolute; }
    &.activeEmptyString { &::after { opacity: 1; animation: pulse 0.3s ease; transform-origin: center; } }
}

.nextActiveEmpty {
    @for $i from 1 through length($string-colors) {
        &[data-string="#{$i}"]::before { box-shadow: 0 0 0 15px rgba(nth($string-colors, $i), 0.3); }
    }
}

.noteFret {
    display: flex;
    flex: 1;
    justify-content: center;
    align-items: center;
    position: relative;
    border-right: 10px solid;
    border-image: linear-gradient(to left, #777, #bbb, #777) 1 100%;

    &:first-child {
        background: #161717;
        z-index: 2;
        min-width: clamp(4rem, 8vw, 5rem);
        flex-grow: 0;
        flex-shrink: 0;
        border-right: 12px solid;
        border-image: linear-gradient(to left, #bbb, #fff, #bbb) 1 100%;
    }

    &::before, &::after {
        width: clamp(1.8rem, 2.2vw, 2.4rem);
        height: clamp(1.8rem, 2.2vw, 2.4rem);
        line-height: clamp(1.8rem, 2.2vw, 2.4rem);
        border-radius: 50%;
        text-align: center;
        color: #ffffff;
        font-weight: 700;
        text-shadow: 1px 1px 2px black;
        opacity: $note-dot-opacity;
        transform: scale(1);
        transition: transform 0.2s ease;
    }

    &::before { content: attr(data-note); z-index: 2; }
    &::after { content: ''; z-index: 1; position: absolute; }

    &.nextActive::after { opacity: 0.5; transform: scale(1.5); }
    &.active::before { opacity: 1; animation: pulse 0.3s ease; }
}

.singleFretmark,
.doubleFretmark {
  position: absolute;
  top: calc(var(--fretboard-height) / 2);
  left: 50%;
  transform: translate(-50%, -50%);
}

.singleFretmark::after,
.doubleFretmark::before,
.doubleFretmark::after {
  content: '';
  position: absolute;
  width: 20px;
  height: 20px;
  border-radius: 50%;
  background-color: #7e633b;
  left: 50%;
  transform: translate(-50%, -50%);
}

.doubleFretmark::before { top: calc(50% - 50px); }
.doubleFretmark::after  { top: calc(50% + 50px); }

:root {
  --fretboard-height: #{$fretboard-height}px;
  --fret-marker-scale: 1;
}
.fretboard { height: var(--fretboard-height); }

@media (min-resolution: 1.25dppx) {
  :root {
    --fretboard-height: #{math.round($fretboard-height * 0.9)}px;
    --fret-marker-scale: .9;
  }
}
@media (min-resolution: 1.4dppx) {
  :root {
    --fretboard-height: #{math.round($fretboard-height * 0.78)}px;
    --fret-marker-scale: .82;
  }
}
@media (min-resolution: 1.5dppx) {
  :root {
    --fretboard-height: #{math.round($fretboard-height * 0.6)}px;
    --fret-marker-scale: .7;
  }
}
@media (min-resolution: 1.6dppx) {
  :root {
    --fretboard-height: #{math.round($fretboard-height * 0.55)}px;
    --fret-marker-scale: .65;
  }
}

.noteFret::before, .noteFret::after { transform: scale(var(--fret-marker-scale)); }
.noteFret.nextActive::after { transform: scale(calc(1.5 * var(--fret-marker-scale))); }
